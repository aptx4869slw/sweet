(function($){var maxfps=25,delay=1/maxfps*1000,lastRender=new Date().getTime(),layers=[],plaxActivityTarget=$(window),motionEnabled=false,motionMax=1,motionAllowance=.05,movementCycles=0,motionLowPassFilter=0.05,motionLastX=1,motionLastY=1,motionData={"xArray":[0,0,0,0,0],"yArray":[0,0,0,0,0],"xMotion":0,"yMotion":0};$.fn.plaxify=function(params){return this.each(function(){var layerExistsAt=-1;var layer={"xRange":$(this).data('xrange')||0,"yRange":$(this).data('yrange')||0,"invert":$(this).data('invert')||false,"background":$(this).data('background')||false};for(var i=0;i<layers.length;i++){if(this===layers[i].obj.get(0)){layerExistsAt=i}}for(var param in params){if(layer[param]==0){layer[param]=params[param]}}layer.inversionFactor=(layer.invert?-1:1);layer.obj=$(this);if(layer.background){pos=(layer.obj.css('background-position')||"0px 0px").split(/ /);if(pos.length!=2){return}x=pos[0].match(/^((-?\d+)\s*px|0+\s*%|left)$/);y=pos[1].match(/^((-?\d+)\s*px|0+\s*%|top)$/);if(!x||!y){return}layer.startX=x[2]||0;layer.startY=y[2]||0}else{var position=layer.obj.position();layer.obj.css({'top':position.top,'left':position.left,'right':'','bottom':''});layer.startX=this.offsetLeft;layer.startY=this.offsetTop}layer.startX-=layer.inversionFactor*Math.floor(layer.xRange/2);layer.startY-=layer.inversionFactor*Math.floor(layer.yRange/2);if(layerExistsAt>=0){layers.splice(layerExistsAt,1,layer)}else{layers.push(layer)}})};function getMin(arr){return Math.min.apply({},arr)}function getMax(arr){return Math.max.apply({},arr)}function moveable(){return window.DeviceMotionEvent!=undefined}function detectMotion(e){if(new Date().getTime()<lastRender+delay)return;if(moveable()){var accel=e.accelerationIncludingGravity,x=accel.x,y=accel.y;x=(x*motionLowPassFilter)+(motionLastX*(1.0-motionLowPassFilter));y=(y*motionLowPassFilter)+(motionLastY*(1.0-motionLowPassFilter));motionLastX=x;motionLastY=y;if(motionData.xArray.length>=5){motionData.xArray.shift()}if(motionData.yArray.length>=5){motionData.yArray.shift()}motionData.xArray.push(x);motionData.yArray.push(y);motionData.xMotion=Math.round((getMax(motionData.xArray)-getMin(motionData.xArray))*1000)/1000;motionData.yMotion=Math.round((getMax(motionData.yArray)-getMin(motionData.yArray))*1000)/1000;if((motionData.xMotion>1.5||motionData.yMotion>1.5)){if(motionMax!=10){motionMax=10}}if(motionData.xMotion>motionAllowance||motionData.yMotion>motionAllowance){movementCycles++}else{movementCycles=0}if(movementCycles>=5){motionEnabled=true;$(document).unbind('mousemove.plax');$(window).bind('devicemotion',plaxifier(e))}else{motionEnabled=false;$(window).unbind('devicemotion');$(document).bind('mousemove.plax',function(e){plaxifier(e)})}}}function plaxifier(e){if(new Date().getTime()<lastRender+delay)return;lastRender=new Date().getTime();var leftOffset=(plaxActivityTarget.offset()!=null)?plaxActivityTarget.offset().left:0,topOffset=(plaxActivityTarget.offset()!=null)?plaxActivityTarget.offset().top:0,x=e.pageX-leftOffset,y=e.pageY-topOffset;if(x<0||x>plaxActivityTarget.width()||y<0||y>plaxActivityTarget.height())return;if(motionEnabled==true){var i=window.orientation?(window.orientation+180)%360/90:2,accel=e.accelerationIncludingGravity,tmp_x=i%2==0?-accel.x:accel.y,tmp_y=i%2==0?accel.y:accel.x;x=i>=2?tmp_x:-tmp_x;y=i>=2?tmp_y:-tmp_y;x=(x+motionMax)/2;y=(y+motionMax)/2;if(x<0){x=0}else if(x>motionMax){x=motionMax}if(y<0){y=0}else if(y>motionMax){y=motionMax}}var hRatio=x/((motionEnabled==true)?motionMax:plaxActivityTarget.width()),vRatio=y/((motionEnabled==true)?motionMax:plaxActivityTarget.height()),layer,i;for(i=layers.length;i--;){layer=layers[i];newX=layer.startX+layer.inversionFactor*(layer.xRange*hRatio);newY=layer.startY+layer.inversionFactor*(layer.yRange*vRatio);if(layer.background){layer.obj.css('background-position',newX+'px '+newY+'px')}else{layer.obj.css('left',newX).css('top',newY)}}}$.plax={enable:function(opts){$(document).bind('mousemove.plax',function(e){if(opts){plaxActivityTarget=opts.activityTarget||$(window)}plaxifier(e)});if(moveable()){window.ondevicemotion=function(e){detectMotion(e)}}},disable:function(){$(document).unbind('mousemove.plax');window.ondevicemotion=undefined}};if(typeof ender!=='undefined'){$.ender($.fn,true)}})(function(){return typeof jQuery!=='undefined'?jQuery:ender}());